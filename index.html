<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Apple ID â€“ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* ====== Theme (Light modal like the mock) ====== */
    :root{
      --overlay: rgba(15,16,20,.55);
      --card-bg: #fff;
      --card-border: #e7e7ea;
      --muted: #6b7280;
      --text: #111827;
      --row-bg: #f7f7fb;
      --row-border: #e9e9f2;
      --primary: #2563eb; /* blue */
      --primary-600:#1e50bd;
      --danger: #ef4444;
      --ghost:#f3f4f6;
      --shadow: 0 10px 40px rgba(0,0,0,.18);
      --radius: 16px;
      --radius-row: 12px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--text);
      background:#f2f3f6;
    }

    /* Transparent backdrop like the mock */
    .backdrop{
      position:fixed; inset:0;
      background:var(--overlay);
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }

    /* Modal card */
    .card{
      width:min(720px, 96vw);
      background:var(--card-bg);
      border:1px solid var(--card-border);
      border-radius:24px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .header{
      display:flex; align-items:center; gap:12px;
      padding:18px 20px;
      border-bottom:1px solid var(--card-border);
    }
    .title{font-size:20px; font-weight:700}
    .close{
      margin-inline-start:auto;
      background:#fff; border:1px solid var(--card-border);
      width:36px; height:36px; display:grid; place-items:center;
      border-radius:999px; cursor:pointer; font-size:18px;
    }
    .content{padding:16px 16px 0}
    .footer{
      display:flex; justify-content:flex-end; gap:10px;
      padding:14px 16px 16px;
      border-top:1px solid var(--card-border);
      background:#fff;
      border-bottom-left-radius:24px; border-bottom-right-radius:24px;
    }

    /* Content rows like the mock */
    .section-title{font-weight:600; margin:12px 6px 8px}
    .note{color:var(--muted); font-size:13px; margin:0 6px 12px}

    .row{
      display:flex; align-items:center; gap:10px;
      background:var(--row-bg);
      border:1px solid var(--row-border);
      border-radius:var(--radius-row);
      padding:10px 12px;
      margin:8px 0;
    }
    .row input{
      flex:1; background:transparent; border:none; outline:none;
      font-size:16px; color:var(--text);
      padding:8px 6px;
    }
    .pill{font-size:12px; color:var(--muted)}

    /* Buttons */
    .btn{
      border:none; cursor:pointer; font-weight:600; border-radius:12px;
      padding:10px 14px; display:inline-flex; align-items:center; gap:8px;
    }
    .btn-primary{background:var(--primary); color:#fff}
    .btn-primary:hover{background:var(--primary-600)}
    .btn-danger{background:var(--danger); color:#fff}
    .btn-ghost{background:#fff; color:var(--text); border:1px solid var(--card-border)}
    .btn-soft{background:var(--ghost); color:var(--text)}
    .btn-icon{
      width:42px; height:42px; display:grid; place-items:center;
      border-radius:10px; background:#fff; border:1px solid var(--card-border);
      font-size:18px;
    }
    .btn-copy{
      background:#ef4444; color:#fff; border:none;
    }

    .two{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:580px){ .two{grid-template-columns:1fr} }

    /* Pages */
    .page{display:none}
    .page.active{display:block}
    .banner{
      margin:0 16px 8px; padding:8px 12px; border-radius:12px;
      background:#eef2ff; color:#1d4ed8; font-size:13px; border:1px solid #dfe7ff;
    }
    .hidden{display:none !important}

    /* QR area */
    .qrbox{display:grid; place-items:center; padding:16px}
    .hint{color:var(--muted); font-size:12px; text-align:center; margin:0 18px 14px}
  </style>
</head>
<body>

  <div class="backdrop">
    <div class="card" id="card-root">
      <!-- ====== Modal Header ====== -->
      <div class="header">
        <div class="title" id="modalTitle">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</div>
        <button class="close" id="closeBtn" title="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
      </div>

      <!-- ====== READ-ONLY banner ====== -->
      <div id="roBanner" class="banner hidden">ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· â€” ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„/ØªØ¹Ø¯ÙŠÙ„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø«Ù… Ø§Ù„Ù†Ø³Ø® Ø£Ùˆ Ø­ÙØ¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙƒØµÙˆØ±Ø©</div>

      <!-- ====== Terms Page ====== -->
      <div id="page-terms" class="page active">
        <div class="content">
          <div class="section-title">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</div>
          <p class="note">Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</p>

          <div class="row" style="align-items:start; padding:14px">
            <div style="line-height:1.8">
              <strong>Ù…Ø­ÙØ¸Ø© Ø­Ø³Ø§Ø¨ APPLE ID:</strong>
              <ul style="margin:8px 18px">
                <li>Ù‡Ø°Ø§ Ø§Ù„ÙƒØ§Ø±Øª Ù‡Ùˆ Ù…Ø­ÙØ¸Ø© Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ.</li>
                <li>ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙ‡Ùˆ Ø¢Ù…Ù† ÙˆÙ…Ø¶Ù…ÙˆÙ†.</li>
                <li>Ø£Ù†Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø£ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠ.</li>
                <li>Ø³ÙŠØªÙ… Ø­ÙØ¸ Ù…ÙˆØ§ÙÙ‚ØªÙƒ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</li>
                <li>Ø§Ø­Ø±Øµ Ø¹Ù„Ù‰ ØªÙØ¹ÙŠÙ„ Ù…ÙŠØ²Ø© Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ iPhone.</li>
              </ul>
              <span class="pill">Ø¨Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙØ£Ù†Øª ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù…Ø§ Ø³Ø¨Ù‚.</span>
            </div>
          </div>
        </div>
        <div class="footer">
          <button class="btn btn-ghost" id="declineBtn">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn btn-primary" id="agreeBtn">Ù…ÙˆØ§ÙÙ‚</button>
        </div>
      </div>

      <!-- ====== Phone Page (viewer only) ====== -->
      <div id="page-phone" class="page">
        <div class="content">
          <div class="section-title">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</div>
          <p class="note">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ù„ÙŠÙØ¶Ø§Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©. ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù… Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¹Ø¨Ø± Â«Ø±Ø¬ÙˆØ¹ Ù„Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙÂ».</p>
          <div class="row">
            <input id="phoneInput" type="tel" placeholder="+9647777777777" autocomplete="tel">
          </div>
        </div>
        <div class="footer">
          <button class="btn btn-ghost" onclick="backToTerms()">Ø±Ø¬ÙˆØ¹</button>
          <button class="btn btn-primary" onclick="proceedPhone()">Ù…ØªØ§Ø¨Ø¹Ø©</button>
        </div>
      </div>

      <!-- ====== Info Page ====== -->
      <div id="page-form" class="page">
        <div id="roTopNote" class="banner hidden">Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶. Ø§Ø³ØªØ®Ø¯Ù… Â«Ø±Ø¬ÙˆØ¹ Ù„Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙÂ» Ù„ØªØ¹Ø¯ÙŠÙ„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙÙ‚Ø·.</div>

        <div class="content">
          <!-- Email -->
          <div class="section-title">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
          <div class="row">
            <button class="btn btn-copy" title="Ù†Ø³Ø®" onclick="copyField('email')">ğŸ“‹</button>
            <input id="email" type="email" placeholder="name@icloud.com" autocomplete="off">
          </div>
          <!-- Password -->
          <div class="section-title">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
          <div class="row">
            <button class="btn btn-copy" title="Ù†Ø³Ø®" onclick="copyField('password')">ğŸ“‹</button>
            <input id="password" type="password" placeholder="@VJQRgts" autocomplete="off">
            <button class="btn-icon" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡" onclick="togglePass()">ğŸ‘ï¸</button>
          </div>
          <!-- Names -->
          <div class="two">
            <div>
              <div class="section-title">First Name</div>
              <div class="row">
                <button class="btn btn-copy" onclick="copyField('fname')">ğŸ“‹</button>
                <input id="fname" type="text" placeholder="Jorge">
                <button class="btn-icon" title="Generate First Name" onclick="genFirstName()">ğŸ²</button>
              </div>
            </div>
            <div>
              <div class="section-title">Last Name</div>
              <div class="row">
                <button class="btn btn-copy" onclick="copyField('lname')">ğŸ“‹</button>
                <input id="lname" type="text" placeholder="Garcia">
                <button class="btn-icon" title="Generate Last Name" onclick="genLastName()">ğŸ²</button>
              </div>
            </div>
          </div>
          <!-- DOB -->
          <div class="section-title">Date of Birth</div>
          <div class="row">
            <button class="btn btn-copy" onclick="copyField('dob')">ğŸ“‹</button>
            <input id="dob" type="text" placeholder="1998/07/21" onblur="validateDOB()" autocomplete="off">
            <button class="btn-icon" title="Generate DOB 1990â€“2006" onclick="genDOB()">ğŸ²</button>
          </div>
          <!-- Phone -->
          <div class="section-title">Phone Number</div>
          <div class="row">
            <button class="btn btn-copy" onclick="copyField('phone')">ğŸ“‹</button>
            <input id="phone" type="text" placeholder="+9647777777777">
          </div>

          <!-- QR + Hint -->
          <p class="hint">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² QR Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª â€” Ø£Ùˆ Ø­ÙØ¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙƒØµÙˆØ±Ø©.</p>
          <div class="qrbox"><div id="qrcode"></div></div>
        </div>

        <div class="footer" id="ownerFooter">
          <button class="btn btn-soft" onclick="genIcloud()">Generate iCloud</button>
          <button class="btn btn-soft" onclick="genPassword()">Generate Password</button>
          <button class="btn btn-soft" onclick="genNames()">Generate Names</button>
          <button class="btn btn-soft" onclick="genDOB()">Generate DOB</button>
          <button class="btn btn-ghost" onclick="copyAll()">Copy All</button>
          <button class="btn btn-primary" onclick="makeQR()">Create QR</button>
        </div>

        <div class="footer hidden" id="viewerFooter">
          <button class="btn btn-ghost" onclick="copyAll()">Copy All</button>
          <button class="btn btn-primary" onclick="saveCardImage()">Save Card as Image</button>
          <button class="btn btn-soft" onclick="goToPhoneFromForm()">Ø±Ø¬ÙˆØ¹ Ù„Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ====== Settings & State ====== */
    let BASE_URL = "";              // Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºÙ‹Ø§ Ù„ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
    const TAC_KEY = "tacAccepted_modal_v1";
    const $ = id => document.getElementById(id);

    let READ_ONLY = false;          // ÙŠØªØ­ÙˆÙ„ true Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ±Ø§Øª (QR)

    /* ====== Modal header title helper ====== */
    function setTitle(t){ $("modalTitle").textContent = t; }

    /* ====== Page navigation ====== */
    function showPage(id){
      document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
      $(id).classList.add("active");
      if(id==="page-terms") setTitle("Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…");
      if(id==="page-phone") setTitle("Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
      if(id==="page-form")  setTitle("Ù…Ø­ÙØ¸Ø© Ø­Ø³Ø§Ø¨ Apple ID"); // ÙÙ‚Ø· Ø¹Ù†ÙˆØ§Ù† Ø£Ù†ÙŠÙ‚ Ù…Ø«Ù„ Ø§Ù„Ù…Ø«Ø§Ù„
    }
    function backToTerms(){ showPage("page-terms"); }
    function goToPhoneFromForm(){ if(READ_ONLY) showPage("page-phone"); }

    /* ====== Lifecycle ====== */
    document.addEventListener("DOMContentLoaded", ()=>{
      // Close just returns to previous step or hides modal (optional)
      $("closeBtn").addEventListener("click", ()=>{
        const termsVisible = $("page-terms").classList.contains("active");
        if(!termsVisible) backToTerms(); else alert("Ø£ØºÙ„Ù‚ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø§Ù„Ø®Ø±ÙˆØ¬.");
      });

      $("agreeBtn").addEventListener("click", acceptTerms);
      $("declineBtn").addEventListener("click", ()=>alert("ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡"));

      prefillFromURL();
      detectReadOnlyByURL();

      // Start: terms always
      showPage("page-terms");
      if(READ_ONLY){
        $("roBanner").classList.remove("hidden");
      }
    });

    function acceptTerms(){
      try{ localStorage.setItem(TAC_KEY,"yes"); }catch(_){}
      // Ø§Ù„Ù…Ø§Ù„Ùƒ: Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª â€” Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯: Ù„ØµÙØ­Ø© Ø§Ù„Ù‡Ø§ØªÙ
      showPage(READ_ONLY ? "page-phone" : "page-form");
      if(!READ_ONLY) {
        $("ownerFooter").classList.remove("hidden");
        $("viewerFooter").classList.add("hidden");
      }
    }

    /* ====== Viewer lock / owner controls ====== */
    function lockUIForViewer(){
      $("roTopNote").classList.remove("hidden");
      $("viewerFooter").classList.remove("hidden");
      $("ownerFooter").classList.add("hidden");
      ["email","password","fname","lname","dob","phone"].forEach(id=>{
        const el=$(id); el.setAttribute("readonly","readonly");
        if(id!=="password") el.setAttribute("aria-readonly","true");
      });
    }

    /* ====== Read-only detection ====== */
    function detectReadOnlyByURL(){
      const q = new URLSearchParams(location.search);
      READ_ONLY = ["email","password","fname","lname","dob","phone"].some(k=>q.get(k));
      // Ø¥Ø°Ø§ ÙˆØµÙ„Ù†Ø§ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª â†’ Ù‡Ùˆ Ù…Ø´Ø§Ù‡Ø¯
      if(READ_ONLY){
        $("viewerFooter").classList.remove("hidden");
        $("ownerFooter").classList.add("hidden");
      } else {
        $("ownerFooter").classList.remove("hidden");
      }
    }

    /* ====== Phone step ====== */
    function proceedPhone(){
      const val = ($("phoneInput").value||"").trim();
      if(!val){ alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©."); return; }
      const digits = val.replace(/[^\d+]/g,"");
      if(digits.length < 7){ alert("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ§Ù„Ø­."); return; }
      $("phone").value = val;
      showPage("page-form");
      if(READ_ONLY) lockUIForViewer();
    }

    /* ====== Helpers & Generators ====== */
    function toast(m){ alert(m); }
    function dynBase(){
      if(BASE_URL && BASE_URL.trim()) return BASE_URL;
      const u = new URL(location.href);
      return u.origin + u.pathname.replace(/index\.html$/,'');
    }

    // Copy utilities
    async function copyField(id){
      const v=$(id).value||"";
      if(!v){ toast("Ø§Ù„Ø­Ù‚Ù„ ÙØ§Ø±Øº"); return; }
      await navigator.clipboard.writeText(v);
      toast("ØªÙ… Ø§Ù„Ù†Ø³Ø®: "+v);
    }
    async function copyAll(){
      const d=collect();
      const t=`Email: ${d.email}
Password: ${d.password}
First Name: ${d.fname}
Last Name: ${d.lname}
Date of Birth: ${d.dob}
Phone: ${d.phone}`;
      await navigator.clipboard.writeText(t);
      toast("ØªÙ… Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
    }

    // Generators
    function genIcloud(len=8){
      if(READ_ONLY) return toast("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·");
      const c="abcdefghijklmnopqrstuvwxyz0123456789";
      let u=""; for(let i=0;i<len;i++) u+=c[Math.floor(Math.random()*c.length)];
      $("email").value = `${u}@icloud.com`;
    }
    function genPassword(len=10){
      if(READ_ONLY) return toast("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·");
      const c="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";
      let p=""; for(let i=0;i<len;i++) p+=c[Math.floor(Math.random()*c.length)];
      $("password").value=p;
    }

    const FIRST=["James","John","Robert","Michael","William","Emily","Emma","Olivia","Sophia","Isabella","Mia","Amelia","Benjamin","Lucas","Ethan","Alexander","Henry","Ava","Charlotte","Lily","Grace","Chloe","Hannah","Ella","Natalie"];
    const LAST=["Smith","Johnson","Williams","Brown","Jones","Garcia","Miller","Davis","Wilson","Anderson","Taylor","Moore","Jackson","Martin","Lee","Perez","Thompson","White","Harris","Clark","Lewis","Robinson","Walker","Young","Allen","King","Wright","Scott","Torres","Nguyen"];
    const pick=a=>a[Math.floor(Math.random()*a.length)];
    function genFirstName(){ if(READ_ONLY) return toast("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­"); $("fname").value=pick(FIRST); }
    function genLastName(){ if(READ_ONLY) return toast("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­"); $("lname").value=pick(LAST); }
    function genNames(){ genFirstName(); genLastName(); }

    function pad2(n){return String(n).padStart(2,"0")}
    function daysInMonth(y,m){ return new Date(y,m,0).getDate(); }
    function randomDOB(){
      const y=1990+Math.floor(Math.random()*(2006-1990+1));
      const m=1+Math.floor(Math.random()*12);
      const d=1+Math.floor(Math.random()*daysInMonth(y,m));
      return `${y}/${pad2(m)}/${pad2(d)}`;
    }
    function genDOB(){ if(READ_ONLY) return toast("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­"); $("dob").value=randomDOB(); }
    function validateDOB(){
      const v=$("dob").value.trim(); if(!v) return;
      const m=v.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})$/);
      if(!m) return toast("ØµÙŠØºØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©: YYYY/MM/DD");
      const y=+m[1], mo=+m[2], d=+m[3];
      if(y<1990||y>2006) return toast("Ø§Ù„Ø³Ù†Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 1990 Ùˆ 2006");
      const dim=daysInMonth(y,mo);
      if(mo<1||mo>12||d<1||d>dim) return toast("ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­");
      $("dob").value=`${y}/${pad2(mo)}/${pad2(d)}`;
    }

    // Build link / QR
    function collect(){
      return{
        email:$("email").value.trim(),
        password:$("password").value.trim(),
        fname:$("fname").value.trim(),
        lname:$("lname").value.trim(),
        dob:$("dob").value.trim(),
        phone:$("phone").value.trim()
      };
    }
    function buildLink(){
      const d=collect(); if(!d.email||!d.password) return null;
      const params=new URLSearchParams(d);
      let base=dynBase(); if(!base.endsWith("/")) base+="/";
      return base+"?"+params.toString();
    }
    function prefillFromURL(){
      const q=new URLSearchParams(location.search);
      ["email","password","fname","lname","dob","phone"].forEach(k=>{
        const v=q.get(k); if(v!==null) $(k).value=v;
      });
    }
    function makeQR(){
      if(READ_ONLY) return toast("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·");
      const link=buildLink(); if(!link) return toast("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
      $("qrcode").innerHTML="";
      new QRCode($("qrcode"),{text:link,width:220,height:220,correctLevel:QRCode.CorrectLevel.H});
    }

    async function saveCardImage(){
      const canvas=await html2canvas($("card-root"),{scale:2,useCORS:true,backgroundColor:null});
      const url=canvas.toDataURL("image/png");
      const a=document.createElement("a"); a.href=url; a.download="apple-id-card.png"; a.click();
    }
  </script>
</body>
</html>
